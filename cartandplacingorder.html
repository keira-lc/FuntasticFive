
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cart & Place Order</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Style 'n Wear</a>
    <div class="d-flex">
      <button id="view-cart-btn" class="btn btn-light">Cart <span id="cart-count" class="badge bg-danger ms-2">0</span></button>
    </div>
  </div>
</nav>

<div class="container my-4">
  <div class="row">
    <div class="col-md-8">
      <h3>Products</h3>
      <div id="products" class="row gy-3">
        <!-- Products will be injected here -->
      </div>
    </div>

    <div class="col-md-4">
      <h3>Your Cart</h3>
      <div id="cart-list" class="list-group mb-3" style="min-height:120px">
        <div class="list-group-item">Cart is empty</div>
      </div>
      <div class="d-flex justify-content-between align-items-center">
        <strong>Total:</strong>
        <h4 id="cart-total">₱0.00</h4>
      </div>
      <button id="checkout-btn" class="btn btn-success w-100 mt-3">Checkout</button>
    </div>
  </div>
</div>

<!-- Checkout Modal -->
<div class="modal fade" id="checkoutModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Checkout</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="checkout-form">
          <div class="mb-3">
            <label class="form-label">Full name</label>
            <input name="name" required class="form-control" placeholder="Juan Dela Cruz">
          </div>
          <div class="mb-3">
            <label class="form-label">Email</label>
            <input type="email" name="email" required class="form-control" placeholder="you@example.com">
          </div>
          <div class="mb-3">
            <label class="form-label">Address</label>
            <input name="address" required class="form-control" placeholder="123 Street, City">
          </div>
          <div class="mb-3">
            <label class="form-label">Notes (optional)</label>
            <textarea name="notes" class="form-control" rows="2"></textarea>
          </div>
          <div class="text-end">
            <button type="submit" class="btn btn-primary">Place Order</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap and dependencies -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script> 
const PRODUCTS = [
  { id: 'p1', title: 'Classic T-shirt', price: 249.00, desc: 'Comfort cotton tee' },
  { id: 'p2', title: 'Cap', price: 149.00, desc: 'Adjustable cap' },
  { id: 'p3', title: 'Mug', price: 99.00, desc: 'Ceramic mug 300ml' }
];

// Utilities
const currency = (v) => '₱' + v.toFixed(2);

// Cart (stored in localStorage)
const CART_KEY = 'simple_demo_cart_v1';
function loadCart() {
  try { return JSON.parse(localStorage.getItem(CART_KEY)) || {}; } catch(e){ return {}; }
}
function saveCart(cart) { localStorage.setItem(CART_KEY, JSON.stringify(cart)); }

// UI rendering
function renderProducts(){
  const el = document.getElementById('products');
  el.innerHTML = '';
  PRODUCTS.forEach(p => {
    const col = document.createElement('div');
    col.className = 'col-md-6';
    col.innerHTML = `
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">${p.title}</h5>
          <p class="card-text">${p.desc}</p>
          <div class="d-flex justify-content-between align-items-center">
            <strong>${currency(p.price)}</strong>
            <button class="btn btn-sm btn-primary add-btn" data-id="${p.id}">Add to cart</button>
          </div>
        </div>
      </div>
    `;
    el.appendChild(col);
  });
}

function renderCart(){
  const list = document.getElementById('cart-list');
  const cart = loadCart();
  const ids = Object.keys(cart);
  list.innerHTML = '';
  if(ids.length === 0){
    list.innerHTML = '<div class="list-group-item">Cart is empty</div>';
  } else {
    ids.forEach(id => {
      const item = cart[id];
      const li = document.createElement('div');
      li.className = 'list-group-item d-flex justify-content-between align-items-center';
      li.innerHTML = `
        <div>
          <div><strong>${item.title}</strong></div>
          <small>${currency(item.price)} × ${item.qty}</small>
        </div>
        <div class="text-end">
          <div>${currency(item.price * item.qty)}</div>
          <div class="btn-group btn-group-sm mt-2" role="group">
            <button class="btn btn-outline-secondary dec-btn" data-id="${id}">-</button>
            <button class="btn btn-outline-secondary inc-btn" data-id="${id}">+</button>
            <button class="btn btn-outline-danger remove-btn" data-id="${id}">Remove</button>
          </div>
        </div>
      `;
      list.appendChild(li);
    });
  }

  // total and count
  const total = ids.reduce((s,id)=> s + cart[id].price * cart[id].qty, 0);
  document.getElementById('cart-total').textContent = currency(total);
  document.getElementById('cart-count').textContent = ids.reduce((c,id)=> c + cart[id].qty, 0);
}

// Actions
function addToCart(id){
  const prod = PRODUCTS.find(p=>p.id===id);
  if(!prod) return;
  const cart = loadCart();
  if(!cart[id]) cart[id] = {...prod, qty:0};
  cart[id].qty += 1;
  saveCart(cart);
  renderCart();
}

function changeQty(id, delta){
  const cart = loadCart();
  if(!cart[id]) return;
  cart[id].qty += delta;
  if(cart[id].qty <= 0) delete cart[id];
  saveCart(cart);
  renderCart();
}

function removeItem(id){
  const cart = loadCart();
  delete cart[id];
  saveCart(cart);
  renderCart();
}

// Wire events
document.addEventListener('click', (e)=>{
  if(e.target.matches('.add-btn')) addToCart(e.target.dataset.id);
  if(e.target.matches('.inc-btn')) changeQty(e.target.dataset.id, 1);
  if(e.target.matches('.dec-btn')) changeQty(e.target.dataset.id, -1);
  if(e.target.matches('.remove-btn')) removeItem(e.target.dataset.id);
});

// Checkout
const checkoutModal = new bootstrap.Modal(document.getElementById('checkoutModal'));
document.getElementById('checkout-btn').addEventListener('click', ()=>{
  const cart = loadCart();
  if(Object.keys(cart).length === 0){
    alert('Your cart is empty. Add items before checkout.');
    return;
  }
  checkoutModal.show();
});

// Place order
document.getElementById('checkout-form').addEventListener('submit', async (ev)=>{
  ev.preventDefault();
  const form = ev.target;
  const formData = Object.fromEntries(new FormData(form).entries());
  const cart = loadCart();
  const items = Object.values(cart).map(i=>({id:i.id, title:i.title, price:i.price, qty:i.qty}));
  const payload = { customer: formData, items, total: items.reduce((s,i)=>s + i.price*i.qty,0)};

  try{
    const resp = await fetch('order.php', {
      method: 'POST', headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(payload)
    });
    if(!resp.ok) throw new Error('Network response was not ok');
    const data = await resp.json();
    // success
    alert('Order placed! Order ID: ' + data.order_id);
    localStorage.removeItem(CART_KEY);
    renderCart();
    form.reset();
    checkoutModal.hide();
  } catch(err){
    console.error(err);
    alert('Failed to place order — see console for details.');
  }
});

// Initial render
renderProducts();
renderCart();
</script>


